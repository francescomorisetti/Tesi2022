* squared_me.F
* this file is part of the process {MD, MD} -> {MM, MM}
* generated by WriteSquaredME 3 Aug 2006 1:50

#include "prefix.h"

	subroutine ddsquared_me(tree, loop, sqrtS,
     +    Hel1from, Hel1to, Hel2from, Hel2to, Hel3from, Hel3to,
     +    Hel4from, Hel4to, reset)
	implicit integer (j)
	implicit character (a-i,k-z)

	double precision tree, loop
	double precision sqrtS
	integer Hel1from, Hel1to, Hel2from, Hel2to, Hel3from, Hel3to
	integer Hel4from, Hel4to
	logical reset

#include "vars.h"

	double precision MomSquare
	external MomSquare

	double complex c, m
	integer Cptr, Dptr
	double precision prevS
	save prevS
	data prevS /-1/

**
**	S = sqrtS**2
**	T = MomSquare(1,9)
**	U = MomSquare(1,13)
**
c	if(reset .or. S .ne. prevS) then
	  call setcachelast(Ccache, 0)
	  call setcachelast(Dcache, 0)
	  call ddabbr_s
c	  reset = .FALSE.
	  prevS = S
c	endif
	Cptr = getcachelast(Ccache)
	Dptr = getcachelast(Dcache)

	call ddabbr_angle1
	call ddabbr_angle2
	call ddabbr_angle3
	call ddabbr_angle4

	tree = 0
	loop = 0

	do 1 Hel1 = Hel1from, Hel1to
	do 1 Hel2 = Hel2from, Hel2to
	do 1 Hel3 = Hel3from, Hel3to
	do 1 Hel4 = Hel4from, Hel4to

	call ddabbr_hel1
	call ddabbr_hel2
	call ddabbr_hel3
	call ddabbr_hel4
	call ddabbr_hel5

	do j7 = 1, 4
	Ctree(j7) = 0
	enddo

	do j8 = 1, 48
	Cloop(j8) = 0
	enddo

	call ddborn
	call ddsself
	call ddvert
	call ddboxa
	call ddboxb
	call ddcts

	do j9 = 1, 4
	c = dconjg(Ctree(j9))

	m = 0
	do j7 = 1, 4
	m = m + Ctree(j7)*MatF(j7,j9)
	enddo
	tree = tree + dble(c*m)

	m = 0
	do j8 = 1, 48

	m = m + Cloop(j8)*MatF(j8,j9)
	enddo
	loop = loop + 2*dble(c*m)

	enddo

1	continue

	call setcachelast(Ccache, Cptr)
	call setcachelast(Dcache, Dptr)
	end

